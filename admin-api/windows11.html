<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft Server Admin - Windows 11</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            overflow: hidden;
            height: 100vh;
            background: linear-gradient(135deg, #647de6, #7a92ff);
            background-size: cover;
        }

        /* Desktop styling */
        .desktop {
            position: relative;
            width: 100%;
            height: calc(100vh - 50px); /* Account for taskbar */
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="transparent"/></svg>');
            background-size: 200px;
        }

        /* Desktop icons */
        .desktop-icons {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 40px;
        }

        .desktop-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 70px;
            cursor: pointer;
            text-align: center;
        }

        .desktop-icon img {
            width: 48px;
            height: 48px;
            margin-bottom: 5px;
            filter: drop-shadow(1px 1px 1px rgba(0,0,0,0.5));
        }

        .desktop-icon span {
            font-size: 12px;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.8);
            background: rgba(0,0,0,0.3);
            padding: 2px 4px;
            border-radius: 4px;
            width: 100%;
        }

        .desktop-icon:hover span {
            background: rgba(255,255,255,0.2);
        }

        /* Windows styling */
        .window {
            position: absolute;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            display: none;
            min-width: 400px;
            min-height: 300px;
            max-width: 800px;
            max-height: 80vh;
        }

        .window.active {
            display: block;
            z-index: 1000;
        }

        .window-header {
            background: linear-gradient(to right, #f0f0f0, #e0e0e0);
            border-bottom: 1px solid #d0d0d0;
            padding: 8px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
            user-select: none;
            border-radius: 8px 8px 0 0;
        }

        .window-title {
            font-size: 14px;
            font-weight: 500;
            color: #333;
        }

        .window-controls {
            display: flex;
            gap: 4px;
        }

        .window-btn {
            width: 32px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 16px;
            border: none;
            background: none;
            color: #333;
        }

        .window-btn:hover {
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
        }

        .window-btn.close:hover {
            background-color: #e81123;
            color: white;
        }

        .window-content {
            padding: 20px;
            height: calc(100% - 40px);
            overflow-y: auto;
            background: white;
            border-radius: 0 0 8px 8px;
        }

        /* Server cards */
        .server-card {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border: 1px solid #e9ecef;
        }

        .server-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .status {
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: 500;
            font-size: 13px;
        }

        .status.running {
            background-color: #d4edda;
            color: #155724;
        }

        .status.stopped {
            background-color: #f8d7da;
            color: #721c24;
        }

        .actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .btn-start {
            background-color: #28a745;
            color: white;
        }

        .btn-stop {
            background-color: #dc3545;
            color: white;
        }

        .btn-restart {
            background-color: #ffc107;
            color: #212529;
        }

        .btn-download {
            background-color: #17a2b8;
            color: white;
        }

        .btn-add-admin {
            background-color: #28a745;
            color: white;
        }

        .btn-remove-admin {
            background-color: #dc3545;
            color: white;
        }

        .btn-refresh {
            background-color: #007bff;
            color: white;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-indicator.running {
            background-color: #28a745;
        }

        .status-indicator.stopped {
            background-color: #dc3545;
        }

        .section-title {
            margin-top: 20px;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #dee2e6;
            color: #495057;
            font-size: 18px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #495057;
        }

        .form-group input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 14px;
        }

        select {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 14px;
            margin-right: 10px;
        }

        /* Taskbar styling */
        .taskbar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 50px;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            z-index: 10000;
            box-shadow: 0 -1px 5px rgba(0, 0, 0, 0.1);
            border-top: 1px solid rgba(0, 0, 0, 0.05);
        }

        .taskbar-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .start-button {
            height: 36px;
            padding: 0 16px;
            background: transparent;
            border: none;
            border-radius: 6px;
            color: #333;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .start-button:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .taskbar-center {
            display: flex;
            gap: 5px;
        }

        .taskbar-icon {
            width: 40px;
            height: 40px;
            border-radius: 6px;
            background: rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .taskbar-icon:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .taskbar-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .time {
            font-size: 14px;
            color: #333;
        }

        /* Start menu */
        .start-menu {
            position: fixed;
            bottom: 50px;
            left: 10px;
            width: 500px;
            height: 500px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            z-index: 9999;
            overflow: hidden;
            display: none;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .start-menu.active {
            display: block;
        }

        .start-menu-content {
            display: flex;
            height: 100%;
        }

        .start-menu-pinned {
            flex: 1;
            padding: 20px;
        }

        .start-menu-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 5px;
        }

        .start-menu-item:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .start-menu-item img {
            width: 32px;
            height: 32px;
            margin-right: 12px;
        }

        /* Players list */
        .players-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .player-tag {
            background-color: #e9ecef;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <!-- Desktop -->
    <div class="desktop">
        <div class="desktop-icons">
            <div class="desktop-icon" onclick="openWindow('server-manager')">
                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23ffffff'%3E%3Cpath d='M4 4h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2zm0 2v12h16V6H4zm2 2h2v2H6V8zm4 0h8v2h-8V8z'/%3E%3C/svg%3E" alt="Server Manager">
                <span>Server Manager</span>
            </div>
            <div class="desktop-icon" onclick="openWindow('admin-tool')">
                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23ffffff'%3E%3Cpath d='M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 8L14.5 9.5L13.5 9.7L12.5 8.5L11 8L7 9V11L8.5 12L7 13V15L11 14L12.5 15.3L13.5 14L14.5 14.5L15 13L21 11V9ZM18.5 16.5L17 15.5L15.5 16.5L15 18L13.5 19.5L15 21L15.5 22.5L17 23L18.5 22.5L19 21L17.5 19.5L19 18L18.5 16.5Z'/%3E%3C/svg%3E" alt="Admin Tool">
                <span>Admin Tool</span>
            </div>
            <div class="desktop-icon" onclick="openWindow('world-downloader')">
                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23ffffff'%3E%3Cpath d='M11 4H13V13L16.5 9.5L17.92 11.08L12 17L6.08 11.08L7.5 9.5L11 13V4ZM4 19H20V21H4V19Z'/%3E%3C/svg%3E" alt="World Downloader"> 
                <span>World Downloader</span>
            </div>
        </div>

        <!-- Server Manager Window -->
        <div class="window" id="server-manager">
            <div class="window-header">
                <div class="window-title">Minecraft Server Manager</div>
                <div class="window-controls">
                    <div class="window-btn" onclick="minimizeWindow('server-manager')">−</div>
                    <div class="window-btn" onclick="maximizeWindow('server-manager')">□</div>
                    <div class="window-btn close" onclick="closeWindow('server-manager')">×</div>
                </div>
            </div>
            <div class="window-content">
                <h1>Minecraft Server Admin</h1>

                <div class="server-card">
                    <div class="server-header">
                        <h2>
                            <span class="status-indicator" id="ilias-status-indicator"></span>
                            mc-ilias
                        </h2>
                        <span class="status" id="ilias-status">Checking...</span>
                    </div>
                    <div class="actions">
                        <button class="btn-start" onclick="startServer('mc-ilias')">Start</button>
                        <button class="btn-stop" onclick="stopServer('mc-ilias')">Stop</button>
                        <button class="btn-restart" onclick="restartServer('mc-ilias')">Restart</button>
                        <button class="btn-download" onclick="downloadWorld('mc-ilias')">Download World</button>
                    </div>
                </div>

                <div class="server-card">
                    <div class="server-header">
                        <h2>
                            <span class="status-indicator" id="niilo-status-indicator"></span>
                            mc-niilo
                        </h2>
                        <span class="status" id="niilo-status">Checking...</span>
                    </div>
                    <div class="actions">
                        <button class="btn-start" onclick="startServer('mc-niilo')">Start</button>
                        <button class="btn-stop" onclick="stopServer('mc-niilo')">Stop</button>
                        <button class="btn-restart" onclick="restartServer('mc-niilo')">Restart</button>
                        <button class="btn-download" onclick="downloadWorld('mc-niilo')">Download World</button>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <button class="btn-refresh" onclick="refreshAllStatus()">Refresh All Status</button>
                </div>
            </div>
        </div>

        <!-- Admin Tool Window -->
        <div class="window" id="admin-tool">
            <div class="window-header">
                <div class="window-title">Minecraft Admin Tool</div>
                <div class="window-controls">
                    <div class="window-btn" onclick="minimizeWindow('admin-tool')">−</div>
                    <div class="window-btn" onclick="maximizeWindow('admin-tool')">□</div>
                    <div class="window-btn close" onclick="closeWindow('admin-tool')">×</div>
                </div>
            </div>
            <div class="window-content">
                <h2 class="section-title">Admin Permissions</h2>
                <div class="server-card">
                    <h3>Manage Admins</h3>
                    <p>Add or remove admin permissions for players</p>

                    <div class="form-group">
                        <label for="username">Player Username:</label>
                        <input type="text" id="username" placeholder="Enter player username">
                    </div>

                    <div class="actions">
                        <select id="server-select">
                            <option value="mc-ilias">mc-ilias</option>
                            <option value="mc-niilo">mc-niilo</option>
                        </select>
                        <button class="btn-add-admin" onclick="addAdmin()">Add Admin</button>
                        <button class="btn-remove-admin" onclick="removeAdmin()">Remove Admin</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- World Downloader Window -->
        <div class="window" id="world-downloader">
            <div class="window-header">
                <div class="window-title">World Downloader</div>
                <div class="window-controls">
                    <div class="window-btn" onclick="minimizeWindow('world-downloader')">−</div>
                    <div class="window-btn" onclick="maximizeWindow('world-downloader')">□</div>
                    <div class="window-btn close" onclick="closeWindow('world-downloader')">×</div>
                </div>
            </div>
            <div class="window-content">
                <h2 class="section-title">Download Worlds</h2>
                <div class="server-card">
                    <h3>Download World Files</h3>
                    <p>Download the current world data from the server as a ZIP archive</p>

                    <div class="actions">
                        <button class="btn-download" onclick="downloadWorld('mc-ilias')">Download mc-ilias World</button>
                        <button class="btn-download" onclick="downloadWorld('mc-niilo')">Download mc-niilo World</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Start Menu -->
    <div class="start-menu" id="start-menu">
        <div class="start-menu-content">
            <div class="start-menu-pinned">
                <div class="start-menu-item" onclick="openWindow('server-manager'); toggleStartMenu();">
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23000000'%3E%3Cpath d='M4 4h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2zm0 2v12h16V6H4zm2 2h2v2H6V8zm4 0h8v2h-8V8z'/%3E%3C/svg%3E" alt="Server Manager">
                    <span>Server Manager</span>
                </div>
                <div class="start-menu-item" onclick="openWindow('admin-tool'); toggleStartMenu();">
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23000000'%3E%3Cpath d='M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 8L14.5 9.5L13.5 9.7L12.5 8.5L11 8L7 9V11L8.5 12L7 13V15L11 14L12.5 15.3L13.5 14L14.5 14.5L15 13L21 11V9ZM18.5 16.5L17 15.5L15.5 16.5L15 18L13.5 19.5L15 21L15.5 22.5L17 23L18.5 22.5L19 21L17.5 19.5L19 18L18.5 16.5Z'/%3E%3C/svg%3E" alt="Admin Tool">
                    <span>Admin Tool</span>
                </div>
                <div class="start-menu-item" onclick="openWindow('world-downloader'); toggleStartMenu();">
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23000000'%3E%3Cpath d='M11 4H13V13L16.5 9.5L17.92 11.08L12 17L6.08 11.08L7.5 9.5L11 13V4ZM4 19H20V21H4V19Z'/%3E%3C/svg%3E" alt="World Downloader">
                    <span>World Downloader</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Taskbar -->
    <div class="taskbar">
        <div class="taskbar-left">
            <button class="start-button" onclick="toggleStartMenu()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 3H11V11H3V3Z" fill="#464646"/>
                    <path d="M13 3H21V11H13V3Z" fill="#464646"/>
                    <path d="M3 13H11V21H3V13Z" fill="#464646"/>
                    <path d="M13 13H21V21H13V13Z" fill="#464646"/>
                </svg>
                Start
            </button>
        </div>
        <div class="taskbar-center">
            <div class="taskbar-icon" onclick="openWindow('server-manager')" title="Server Manager">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 4h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2zm0 2v12h16V6H4zm2 2h2v2H6V8zm4 0h8v2h-8V8z" fill="#464646"/>
                </svg>
            </div>
            <div class="taskbar-icon" onclick="openWindow('admin-tool')" title="Admin Tool">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 8L14.5 9.5L13.5 9.7L12.5 8.5L11 8L7 9V11L8.5 12L7 13V15L11 14L12.5 15.3L13.5 14L14.5 14.5L15 13L21 11V9ZM18.5 16.5L17 15.5L15.5 16.5L15 18L13.5 19.5L15 21L15.5 22.5L17 23L18.5 22.5L19 21L17.5 19.5L19 18L18.5 16.5Z" fill="#464646"/>
                </svg>
            </div>
            <div class="taskbar-icon" onclick="openWindow('world-downloader')" title="World Downloader">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M11 4H13V13L16.5 9.5L17.92 11.08L12 17L6.08 11.08L7.5 9.5L11 13V4ZM4 19H20V21H4V19Z" fill="#464646"/>
                </svg>
            </div>
        </div>
        <div class="taskbar-right">
            <div class="time" id="current-time"></div>
        </div>
    </div>

    <script>
        // Window management functions
        function openWindow(windowId) {
            const windowElement = document.getElementById(windowId);
            if (windowElement) {
                windowElement.classList.add('active');
                bringToFront(windowElement);
            }
        }
        
        function closeWindow(windowId) {
            const windowElement = document.getElementById(windowId);
            if (windowElement) {
                windowElement.classList.remove('active');
            }
        }
        
        function minimizeWindow(windowId) {
            const windowElement = document.getElementById(windowId);
            if (windowElement) {
                windowElement.classList.remove('active');
            }
        }
        
        function maximizeWindow(windowId) {
            const windowElement = document.getElementById(windowId);
            if (windowElement) {
                windowElement.classList.toggle('maximized');
            }
        }
        
        function bringToFront(element) {
            const windows = document.querySelectorAll('.window');
            let maxZ = 1000;
            for (const win of windows) {
                const z = parseInt(win.style.zIndex || 1);
                if (z > maxZ) maxZ = z;
            }
            element.style.zIndex = maxZ + 1;
        }
        
        // Window dragging functionality
        const windowHeaders = document.querySelectorAll('.window-header');
        windowHeaders.forEach(header => {
            header.addEventListener('mousedown', (e) => {
                const windowEl = header.parentElement;
                bringToFront(windowEl);
                
                const offsetX = e.clientX - windowEl.getBoundingClientRect().left;
                const offsetY = e.clientY - windowEl.getBoundingClientRect().top;
                
                function moveWindow(e) {
                    windowEl.style.left = (e.clientX - offsetX) + 'px';
                    windowEl.style.top = (e.clientY - offsetY) + 'px';
                }
                
                function stopMove() {
                    document.removeEventListener('mousemove', moveWindow);
                    document.removeEventListener('mouseup', stopMove);
                }
                
                document.addEventListener('mousemove', moveWindow);
                document.addEventListener('mouseup', stopMove);
            });
        });
        
        // Time display
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            document.getElementById('current-time').textContent = timeString;
        }
        
        setInterval(updateTime, 1000);
        updateTime();
        
        // Start menu functionality
        function toggleStartMenu() {
            const startMenu = document.getElementById('start-menu');
            startMenu.classList.toggle('active');
            
            // Close menu when clicking outside
            if (startMenu.classList.contains('active')) {
                setTimeout(() => {
                    document.addEventListener('click', function closeMenu(e) {
                        if (!startMenu.contains(e.target) && !e.target.closest('.start-button')) {
                            startMenu.classList.remove('active');
                            document.removeEventListener('click', closeMenu);
                        }
                    });
                }, 100);
            }
        }
        
        // Function to update status display
        function updateStatus(serverName, status) {
            const statusElement = document.getElementById(`${serverName.split('-')[1]}-status`);
            const indicatorElement = document.getElementById(`${serverName.split('-')[1]}-status-indicator`);

            if (statusElement && indicatorElement) {
                statusElement.textContent = status;
                statusElement.className = `status ${status.toLowerCase()}`;
                indicatorElement.className = `status-indicator ${status.toLowerCase()}`;
            }
        }

        // Function to get server status
        async function getServerStatus(serverName) {
            try {
                const response = await fetch(`/api/status/${serverName}`);
                const data = await response.json();
                updateStatus(serverName, data.status);
            } catch (error) {
                updateStatus(serverName, 'Error');
                console.error('Error getting status:', error);
            }
        }

        // Function to control server
        async function controlServer(serverName, action) {
            try {
                const response = await fetch(`/api/${action}/${serverName}`, {
                    method: 'POST'
                });

                if (response.ok) {
                    // Wait a moment before refreshing status
                    setTimeout(() => getServerStatus(serverName), 2000);
                } else {
                    alert(`Failed to ${action} ${serverName}`);
                }
            } catch (error) {
                console.error(`Error ${action}ing ${serverName}:`, error);
                alert(`Error ${action}ing ${serverName}`);
            }
        }

        // Function to download world
        async function downloadWorld(serverName) {
            try {
                const response = await fetch(`/api/download/world/${serverName}`, {
                    method: 'GET'
                });

                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${serverName}-world.zip`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                } else {
                    const errorText = await response.text();
                    alert(`Failed to download world: ${response.status} - ${errorText}`);
                }
            } catch (error) {
                console.error('Error downloading world:', error);
                alert(`Error downloading world: ${error.message}`);
            }
        }

        // Function to add admin
        async function addAdmin() {
            const username = document.getElementById('username').value.trim();
            const serverName = document.getElementById('server-select').value;

            if (!username) {
                alert('Please enter a username');
                return;
            }

            try {
                const response = await fetch(`/api/admin/add/${serverName}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username: username })
                });

                if (response.ok) {
                    alert(`Added ${username} as admin to ${serverName}`);
                    document.getElementById('username').value = '';
                } else {
                    const errorText = await response.text();
                    alert(`Failed to add admin: ${response.status} - ${errorText}`);
                }
            } catch (error) {
                console.error('Error adding admin:', error);
                alert(`Error adding admin: ${error.message}`);
            }
        }

        // Function to remove admin
        async function removeAdmin() {
            const username = document.getElementById('username').value.trim();
            const serverName = document.getElementById('server-select').value;

            if (!username) {
                alert('Please enter a username');
                return;
            }

            try {
                const response = await fetch(`/api/admin/remove/${serverName}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username: username })
                });

                if (response.ok) {
                    alert(`Removed ${username} as admin from ${serverName}`);
                    document.getElementById('username').value = '';
                } else {
                    const errorText = await response.text();
                    alert(`Failed to remove admin: ${response.status} - ${errorText}`);
                }
            } catch (error) {
                console.error('Error removing admin:', error);
                alert(`Error removing admin: ${error.message}`);
            }
        }

        // Wrapper functions for button actions
        function startServer(serverName) {
            controlServer(serverName, 'start');
        }

        function stopServer(serverName) {
            controlServer(serverName, 'stop');
        }

        function restartServer(serverName) {
            controlServer(serverName, 'restart');
        }

        function refreshAllStatus() {
            getServerStatus('mc-ilias');
            getServerStatus('mc-niilo');
        }

        // Initial status check when page loads
        window.onload = function() {
            openWindow('server-manager');
            refreshAllStatus();
            // Refresh status every 30 seconds
            setInterval(refreshAllStatus, 30000);
        };
    </script>
</body>
</html>