#!/bin/bash

# Minecraft Server Infrastructure - Production Deployment Script
# Version: 1.0
# Purpose: Complete deployment instructions for production server

echo "=================================================="
echo "Minecraft Server Infrastructure - Production Deployment"
echo "=================================================="

echo ""
echo "STEP 1: Build containers (already completed)"
echo "All containers have been successfully built with tags:"
echo "  - latest"
echo "  - prod-v1.0"
echo ""

echo "STEP 2: Push containers to your registry"
echo "Run the following command to tag and push to your registry:"
echo "  ./push-containers.sh [your-registry] [your-repo-prefix]"
echo ""
echo "EXAMPLES:"
echo "  For Docker Hub: ./push-containers.sh docker.io yourusername"
echo "  For your own registry: ./push-containers.sh your.registry.com your-repo"
echo ""

echo "STEP 3: Deploy to production server"
echo "After pushing images to the registry, follow these steps:"
echo ""
echo "A. SSH into your production server:"
echo "  ssh root@161.97.82.122"
echo ""
echo "B. Pull the updated images:"
echo "  docker pull your-registry/mc-server/admin-ui:prod-v1.0"
echo "  docker pull your-registry/mc-server/mc-ilias:prod-v1.0"
echo "  docker pull your-registry/mc-server/ilias-admin-ui:prod-v1.0"
echo "  docker pull your-registry/mc-server/mc-niilo:prod-v1.0"
echo "  docker pull your-registry/mc-server/niilo-admin-ui:prod-v1.0"
echo "  docker pull your-registry/mc-server/school-server:prod-v1.0"
echo "  docker pull your-registry/mc-server/school-admin-ui:prod-v1.0"
echo "  docker pull your-registry/mc-server/general-server:prod-v1.0"
echo "  docker pull your-registry/mc-server/general-admin-ui:prod-v1.0"
echo ""
echo "C. Create directory structure:"
echo "  mkdir -p mc-ilias/data mc-ilias/datapacks"
echo "  mkdir -p mc-niilo/data mc-niilo/datapacks"
echo "  mkdir -p school/data school/datapacks"
echo "  mkdir -p general/data general/datapacks"
echo ""
echo "D. Update the production docker-compose files to use YOUR registry:"
echo "  sed -i 's|your-registry|YOUR_REGISTRY|g' docker-compose-main-prod.yml docker-compose-ilias-prod.yml docker-compose-niilo-prod.yml docker-compose-school-prod.yml docker-compose-general-prod.yml"
echo "  sed -i 's|mc-server|YOUR_REPO_PREFIX/mc-server|g' docker-compose-main-prod.yml docker-compose-ilias-prod.yml docker-compose-niilo-prod.yml docker-compose-school-prod.yml docker-compose-general-prod.yml"
echo ""
echo "E. Deploy the services:"
echo "  docker-compose -f docker-compose-main-prod.yml up -d --force-recreate"
echo "  docker-compose -f docker-compose-ilias-prod.yml up -d --force-recreate"
echo "  docker-compose -f docker-compose-niilo-prod.yml up -d --force-recreate"
echo "  docker-compose -f docker-compose-school-prod.yml up -d --force-recreate"
echo "  docker-compose -f docker-compose-general-prod.yml up -d --force-recreate"
echo ""
echo "F. Verify the deployment:"
echo "  docker ps"
echo "  docker logs mc-admin-ui"
echo "  docker logs mc-ilias"
echo "  docker logs mc-niolo"
echo "  docker logs school-server"
echo "  docker logs general-server"
echo ""

echo "STEP 4: Services will be accessible at:"
echo "  Main Admin UI: http://161.97.82.122:3000"
echo "  mc-ilias Admin UI: http://161.97.82.122:3001"
echo "  mc-niilo Admin UI: http://161.97.82.122:3002"
echo "  School Server Admin UI: http://161.97.82.122:3003"
echo "  General Server Admin UI: http://161.97.82.122:3004"
echo ""

echo "STEP 5: Use maintenance script for ongoing operations:"
echo "  ./maintenance-services.sh [command]"
echo "  Available commands: help, logs, stats, cleanup, restart, down, prune"
echo ""

echo "=================================================="
echo "DEPLOYMENT SUMMARY:"
echo "- All containers built and tagged with latest and prod-v1.0"
echo "- Production-ready docker-compose files created"
echo "- Push script created for registry upload"
echo "- Complete deployment instructions provided above"
echo "=================================================="